#!/usr/bin/env node

var path = require('path');
var fs = require('fs');

var argv = require('optimist').argv;

var gulp = require('../');
var gulpFilename = getGulpFile();
var tasks = argv._;

if (!gulpFilename) {
  throw new Error("Missing Gulpfile");
}

// Expose CLI flags to tasks or plugins
gulp.env = tasks;

var theGulpfile = require(gulpFilename);

gulp.run.apply(gulp, tasks);

function getGulpFile() {
  var extensions = Object.keys(require.extensions);
  var Gulpfiles = extensions.map(function(ext){
    return path.join(process.cwd(), "Gulpfile" + ext);
  });

  var gulpFiles = extensions.map(function(ext){
    return path.join(process.cwd(), "gulpfile" + ext);
  });

  return gulpFiles.concat(Gulpfiles)
    .filter(fs.existsSync)[0];
}